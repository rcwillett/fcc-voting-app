angular.module("pollApp",["ngRoute","toastr"]).run(["$rootScope","$location","loginService","notificationService","appConstants",function(o,e,t,l,n){o.loading=!0,o.loggedIn=!1,t.isLoggedIn().then(function(e){o.loggedIn=e.data.status,o.loading=!1},function(e){o.loggedIn=!1,o.loading=!1}),o.$on("$routeChangeStart",function(t,r,i){o.loggedIn||r.$$route&&n.restrictedRoutes.indexOf(r.$$route.originalPath)>-1&&(e.path("/login"),l.warn("You must log in to access this part of the site"))})}]).config(["$routeProvider","appConstants",function(o,e){o.when("/viewPoll/:pollId",{templateUrl:"/public/js/app/templates/poll.html",controller:"pollViewController"}).when("/createPoll",{templateUrl:"/public/js/app/templates/createEditPoll.html",controller:"createEditPollController",createEdit:e.createEditEnum.create}).when("/editPoll/:pollId",{templateUrl:"/public/js/app/templates/createEditPoll.html",controller:"createEditPollController",createEdit:e.createEditEnum.edit}).when("/pollStats/:pollId",{templateUrl:"/public/js/app/templates/pollStats.html",controller:"pollStatsController"}).when("/myPolls",{templateUrl:"/public/js/app/templates/userPolls.html",controller:"userPollController"}).when("/login",{templateUrl:"/public/js/app/templates/login.html",controller:"loginController"}).otherwise({templateUrl:"/public/js/app/templates/home.html",controller:"pollController"})}]),angular.module("pollApp").constant("appConstants",{createEditEnum:{create:0,edit:1},restrictedRoutes:["/myPolls","/createPoll","/pollStats","/editPoll"]}),function(){angular.module("pollApp").controller("createEditPollController",["$scope","$timeout","$route","$routeParams","OptionModel","PollModel","pollService","appConstants","notificationService",function(o,e,t,l,n,r,i,a,p){function u(o){t.current.$$route.createEdit===a.createEditEnum.edit?p.success("Poll Successfully Edited!"):p.success("Poll Successfully Created!"),window.location="/#!/viewPoll/"+o.data.pollId}function c(o){p.success("Poll Deleted!"),window.location="/#!/home"}function s(o){401===o.status||403===o.status?window.location.href="/#!/login":p.error(o.message)}function d(o,e,t,l){r.call(this,e,t,"","",l),this.pollId=o}o.vm={};var f=o.vm;f.addOptionError=!1,f.isEditing=!1,f.addOption=function(){var o=function(){for(var o=0;o<f.pollOptions.length;o++)if(!f.pollOptions[o].optionText)return!1;return!0}();if(f.addOptionError=!1,0===f.pollOptions.length||o){var e=f.pollOptions.length;f.pollOptions.push({optionId:e,optionText:""})}else f.addOptionError=!0,p.error("Form error. Please ensure the form fields are filled correctly")},f.removeOption=function(o){f.pollOptions.splice(o,1),f.pollOptions.forEach(function(o,e){o.optionId=e})},f.submitPoll=function(){f.pollOptions.length>1&&t.current.$$route.createEdit===a.createEditEnum.edit&&o.createPollForm.$valid?($("#confirmEditModal").modal("hide"),i.editPoll(l.pollId,new d(f.pollId,f.pollTitle,f.pollDescription,f.pollOptions)).then(u,s)):f.pollOptions.length>1&&f.pollTitle&&o.createPollForm.$valid?i.createPoll(new d(f.pollId,f.pollTitle,f.pollDescription,f.pollOptions)).then(u,s):p.error("Form Error. Please ensure the form fields are filled correctly.")},f.deletePoll=function(){$("#confirmDeleteModal").modal("hide"),i.deletePoll(l.pollId).then(c,s)},t.current.$$route.createEdit===a.createEditEnum.edit?(f.isEditing=!0,i.getPoll(l.pollId).then(function(o){f.pollId=o.data.pollInfo.id,f.pollTitle=o.data.pollInfo.name,f.pollDescription=o.data.pollInfo.description,f.pollOptions=o.data.pollInfo.options,f.submitText="Update Poll"},function(o){console.error(o),window.location.href="/#!/404"})):(f.pollTitle="",f.pollDescription="",f.pollId=null,f.pollOptions=[new n(0,"",0)],f.submitText="Create Poll")}])}(),angular.module("pollApp").controller("loginController",["$scope","$rootScope","$route","$routeParams","loginService",function(o,e,t,l,n){function r(o){}function i(o){a.error=!0}o.vm={};var a=o.vm;a.logInWithGit=function(){n.login().then(r,i)},a.showError=Boolean(l.error),a.errorMessage="Login Failed, Please Try Again"}]),angular.module("pollApp").controller("menuController",["$scope","$rootScope","loginService",function(o,e,t){function l(){e.loggedIn=!1,window.location.href="/"}function n(){e.error=!0}(o.menuVm={}).logOut=function(){t.logout().then(l,n)}}]),angular.module("pollApp").controller("pollStatsController",["$routeParams","$scope","$timeout","chartService","pollService",function(o,e,t,l,n){e.vm={};var r=e.vm;r.unexpectedError=!1,r.optionResults=[],null!=o.pollId&&""!==o.pollId?n.getPoll(o.pollId).then(function(o){r.poll=o.data.pollInfo;var e=[],t=[];r.poll.options.forEach(function(o,l,n){e.push(o.optionText),t.push(o.numTimesSelected)}),l.initBarChart("bar-chart-results",e,t),l.initPieChart("pie-chart-results",e,t)},function(o){r.unexpectedError=!0}):window.location.href="/404"}]),angular.module("pollApp").controller("pollViewController",["$routeParams","$scope","$rootScope","$timeout","chartService","pollService","notificationService",function(o,e,t,l,n,r,i){function a(o){var e=o.data.pollInfo.options.map(function(o){return o.optionText}),t=o.data.pollInfo.options.map(function(o){return o.numTimesSelected});f.poll=o.data.pollInfo,f.selectedOption=o.data.userSelection?f.poll.options[o.data.userSelection]:f.poll.options[0],f.facebookShareLink="https://www.facebook.com/sharer/sharer.php?u="+window.encodeURI(window.location.href),f.twitterShareLink="https://twitter.com/home?status="+window.encodeURI(window.location.href),n.initPieChart("pie-chart-results",e,t)}function p(){r.vote(o.pollId,f.selectedOption.optionId).then(function(o){i.success("Option Selection Successful")})}function u(){e.newOptionForm.newPollOption.$error.required||e.newOptionForm.newPollOption.$error.pattern||r.addPollOption(o.pollId,f.newPollOption).then(c,d)}function c(o){f.newOptionFormVisible=!1,f.addNewOptionVisible=!1,f.poll=o.data.data,i.success("New Option Added")}function s(){t.loggedIn&&(f.newOptionFormVisible=!0,f.addNewOptionVisible=!1)}function d(o){i.error(o.message)}e.vm={};var f=e.vm;f.unexpectedError=!1,f.newOptionFormVisible=!1,f.addNewOptionVisible=!0,f.submitSelection=p,f.submitNewOption=u,f.addNewOption=s,f.inputValidationPattern=/[a-zA-Z0-9]/,f.newPollOption="",null!=o.pollId&&""!==o.pollId?r.getPoll(o.pollId).then(a,d):window.location.href="/404"}]),angular.module("pollApp").controller("pollController",["$scope","pollService",function(o,e){o.pollArray=[],e.getPolls(10).then(function(e){o.pollArray=e.data})}]),angular.module("pollApp").controller("userPollController",["$scope","pollService",function(o,e){function t(o){n.pollArray=o.data,n.loading=!1}function l(o){401!==o.status&&403!==o.status||(window.location.href="/#!/login")}o.vm={};var n=o.vm;n.loading=!0,n.error=!1,n.pollArray=[],n.generateStatsLink=function(o){return"#!pollStats/"+o},n.generateEditLink=function(o){return"#!editPoll/"+o},e.getUserPolls().then(t,l)}]),angular.module("pollApp").service("chartService",function(){function o(o,e){var t,l,n,r=e/o,i=~~(6*r),a=6*r-i,p=1-a;switch(i%6){case 0:t=1,l=a,n=0;break;case 1:t=p,l=1,n=0;break;case 2:t=0,l=1,n=a;break;case 3:t=0,l=p,n=1;break;case 4:t=a,l=0,n=1;break;case 5:t=1,l=0,n=p}return"#"+("00"+(~~(255*t)).toString(16)).slice(-2)+("00"+(~~(255*l)).toString(16)).slice(-2)+("00"+(~~(255*n)).toString(16)).slice(-2)}return{initBarChart:function(e,t,l){var n=document.getElementById(e).getContext("2d"),r=[];t.forEach(function(e,t,l){r.push(o(l.length,t))}),new Chart(n,{type:"bar",data:{labels:t,datasets:[{label:"# of Votes",data:l,backgroundColor:r,borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0},label:"# of Votes"}]}},responsive:!0})},initPieChart:function(e,t,l){var n=document.getElementById(e).getContext("2d"),r=[];t.forEach(function(e,t,l){r.push(o(l.length,t))}),new Chart(n,{type:"pie",data:{labels:t,datasets:[{label:"# of Votes",data:l,backgroundColor:r,borderWidth:1}]},options:{},responsive:!0})}}}),angular.module("pollApp").service("loginService",["$rootScope","$http",function(o,e){return this.login=function(){return e.get("/auth/github")},this.logout=function(){return e.get("/logout")},this.isLoggedIn=function(){return e.get("/isLoggedIn")},this}]),angular.module("pollApp").service("notificationService",["toastr",function(o){return{success:function(e){o.success(e)},error:function(e){o.error(e)},warn:function(e){o.warning(e)}}}]),angular.module("pollApp").service("pollService",["$http",function(o){return this.getPoll=function(e){return o({method:"GET",url:"/poll/"+e})},this.getPolls=function(e){return o({method:"GET",url:"/polls",params:{numItems:e}})},this.getUserPolls=function(e){return o({method:"GET",url:"/userPolls"})},this.createPoll=function(e){return o({method:"POST",url:"/addPoll",data:e})},this.editPoll=function(e,t){return o({method:"POST",url:"/editPoll",data:{pollId:e,pollData:t}})},this.deletePoll=function(e){return o({method:"POST",url:"/deletePoll",data:{pollId:e}})},this.addPollOption=function(e,t){return o({method:"POST",url:"/addPollOption",data:{pollId:e,optionText:t},type:"application/json"})},this.vote=function(e,t){return o({method:"POST",url:"/vote",data:{pollId:e,optionId:t},type:"application/json"})},this}]),angular.module("pollApp").service("userService",["$http",function(o){return this.getUserInfo=function(){return o({method:"GET",url:"/getUserInfo"})},this}]);var OptionModel=function(o,e,t){this.optionId=o,this.optionText=e,this.numTimesSelected=t||0};"undefined"!=typeof module&&module.exports?module.exports=OptionModel:"undefined"!=typeof angular&&angular.module("pollApp").factory("OptionModel",function(){return OptionModel});var PollOptionModel;PollOptionModel="undefined"!=typeof require?require("./option.js"):OptionModel||function(){};var PollModel=function(o,e,t,l,n){this.name=o,this.description=e,this.creator={id:t,userName:l},this.options=function(o){var e=[];return o.forEach(function(o){e.push(new PollOptionModel(o.optionId,o.optionText,o.numTimesSelected))}),e}(n)};"undefined"!=typeof module&&module.exports?module.exports=PollModel:"undefined"!=typeof angular&&angular.module("pollApp").factory("PollModel",function(){return PollModel});var PollInfo=function(o,e){this.id=o,this.name=e};"undefined"!=typeof module&&module.exports?module.exports=PollInfo:"undefined"!=typeof angular&&angular.module("pollApp").factory("PollInfo",function(){return PollInfo});var UserSelection=function(o,e,t){this.userId=o,this.uuid=e,this.optionId=t};"undefined"!=typeof module&&module.exports?module.exports=UserSelection:"undefined"!=typeof angular&&angular.module("pollApp").factory("UserSelection",function(){return UserSelection});
//# sourceMappingURL=../maps/site.min.js.map
